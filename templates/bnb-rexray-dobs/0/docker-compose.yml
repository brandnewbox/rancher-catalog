version: '2'
services:
  rexray-dobs:
    image: gustavosbarreto/mender-rexray-dobs-driver
    stdin_open: true
    tty: true
    privileged: true
    network_mode: host
    volumes:
      - /run:/run
      - /var/run:/var/run
      - /dev:/host/dev
      - /var/lib/rancher/volumes:/var/lib/rancher/volumes:shared
    environment:
      LIBSTORAGE_SERVICE: 'dobs'
      DOBS_TOKEN: '${DOBS_TOKEN}'
      DEFAULT_VOLUME_SIZE: '${DEFAULT_VOLUME_SIZE}'
      RANCHER_DEBUG: '${RANCHER_DEBUG}'
    labels:
      io.rancher.container.pull_image: always
      io.rancher.scheduler.global: true
      io.rancher.container.create_agent: 'true'
      io.rancher.container.agent.role: environment
      io.rancher.container.pull_image: always
      {{- if ne .Values.host_label ""}}
      io.rancher.scheduler.affinity:host_label: ${host_label}
      {{- end}}
